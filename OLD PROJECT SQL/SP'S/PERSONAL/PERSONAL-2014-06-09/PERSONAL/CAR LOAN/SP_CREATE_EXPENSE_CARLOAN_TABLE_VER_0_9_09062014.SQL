-- version:0.9 -- sdate:09/06/2014 -- edate:09/06/2014 -- issue:566 --COMMENT NO: 12--desc:IMPLEMENTED ROLL BACK AND COMMIT --doneby:RAJA
-- version:0.8 -- sdate:28/03/2014 -- edate:28/03/2014 -- issue:765 --desc: SOURCE ND DESTINATION SCHEMA GET DYNAMICALLY --doneby:RL
-- version:0.7 -- sdate:17/03/2014 -- edate:17/03/2014 -- issue:765 --desc:droped temp table --doneby:RL
--version:0.6--sdate:22/02/2014 --edate:22/02/2014 --issue:750 -desc:changes source timestamp and userstamp as uld_id done by:dhivya
--version:0.5--sdate:22/02/2014 --edate:22/02/2014 --issue:750 -desc:added preaudit and post audit queries done by:dhivya
--version:0.4 --sdate:04/02/2014 --edate:04/02/2014 --desc:removed main table updation sp  --doneby:RL 
--version:0.3 --sdate:01/02/2014 --edate:01/02/2014 --desc:looping changed as cursor --doneby:RL --issue:718

--CREATE QUERY FOR EXPENSE CARLOAN
DROP PROCEDURE IF EXISTS SP_CREATE_EXPENSE_CARLOAN_TABLE;
CREATE PROCEDURE SP_CREATE_EXPENSE_CARLOAN_TABLE(IN DESTINATIONSCHEMA VARCHAR(50))
BEGIN
DECLARE EXIT HANDLER FOR SQLEXCEPTION
BEGIN
ROLLBACK;
END;
START TRANSACTION;
	SET FOREIGN_KEY_CHECKS=0;
	
	SET @EXPENSE_CAR_LOANDROPQUERY=(SELECT CONCAT('DROP TABLE IF EXISTS ',DESTINATIONSCHEMA,'.EXPENSE_CAR_LOAN'));
	PREPARE EXPENSE_CAR_LOANDROPQUERYSTMT FROM @EXPENSE_CAR_LOANDROPQUERY;
	EXECUTE EXPENSE_CAR_LOANDROPQUERYSTMT;
	
	SET @EXPENSE_CAR_LOANCREATEQUERY=(SELECT CONCAT('CREATE TABLE ',DESTINATIONSCHEMA,'.EXPENSE_CAR_LOAN(
	ECL_ID INTEGER NOT NULL AUTO_INCREMENT,
	ECL_PAID_DATE DATE NOT NULL,
	ECL_FROM_PERIOD DATE NOT NULL,
	ECL_TO_PERIOD DATE NOT NULL,
	ECL_AMOUNT DECIMAL(7,2)NOT NULL,
	ECL_COMMENTS TEXT,
	ULD_ID INTEGER(2)NOT NULL,
	ECL_TIMESTAMP TIMESTAMP NOT NULL,
	PRIMARY KEY(ECL_ID),
	FOREIGN KEY (ULD_ID)REFERENCES ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS(ULD_ID))'));
	PREPARE EXPENSE_CAR_LOANCREATEQUERYSTMT FROM @EXPENSE_CAR_LOANCREATEQUERY;
	EXECUTE EXPENSE_CAR_LOANCREATEQUERYSTMT;
	SET FOREIGN_KEY_CHECKS=1;
COMMIT;
END;