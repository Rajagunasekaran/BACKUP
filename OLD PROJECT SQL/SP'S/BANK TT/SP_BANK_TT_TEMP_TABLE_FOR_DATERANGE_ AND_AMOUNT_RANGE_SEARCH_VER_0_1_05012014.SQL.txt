--> version 0.1 -->startdate:05/01/2014  enddate:05/01/2014-->
-->desc:TEMP TABLE FOR BANK TT AMOUNT RANGE SEARCH AND DATE RANGE SEARCH
-->doneby:KUMAR.R

DROP PROCEDURE IF EXISTS SP_TEMP_BANK_TT_DATEANDAMOUNTRANGE_SERACH;
CREATE PROCEDURE SP_TEMP_BANK_TT_DATEANDAMOUNTRANGE_SERACH(
IN FROMVALUE VARCHAR(15),
IN TOVALUE VARCHAR(15),
IN SEARCHOPTION INTEGER)
BEGIN
DECLARE EXIT HANDLER FOR SQLEXCEPTION
BEGIN 
ROLLBACK;
END;
START TRANSACTION;
DROP TABLE IF EXISTS BANKTT_TEMP_TABLE;
CREATE TABLE BANKTT_TEMP_TABLE(SNO INTEGER AUTO_INCREMENT NOT NULL PRIMARY KEY,BT_ID INTEGER,BTT_DATA VARCHAR(50),BT_DATE DATE,UNIT_NO INTEGER,CUSTOMER_FIRST_NAME VARCHAR(50),CUSTOMER_LAST_NAME VARCHAR(50),BT_ACC_NO VARCHAR(25),BT_ACC_NAME VARCHAR(25),BT_AMOUNT DECIMAL(7,2),BTS_DATA VARCHAR(20),BT_DEBITED_ON DATE,BT_BANK_CODE VARCHAR(4),BT_BRANCH_CODE VARCHAR(4),BT_BANK_ADDRESS TEXT,BT_SWIFT_CODE VARCHAR(25),BTCT_DATA VARCHAR(20),BT_CUST_REF VARCHAR(50),BT_INV_DETAILS TEXT,BTCB_DATA VARCHAR(50),BT_COMMENTS TEXT,BT_USERSTAMP VARCHAR(50),BT_TIMESTAMP TIMESTAMP);
IF (SEARCHOPTION=3) THEN
INSERT INTO BANKTT_TEMP_TABLE(BT_ID,BTT_DATA,BT_DATE,UNIT_NO,CUSTOMER_FIRST_NAME,CUSTOMER_LAST_NAME,BT_ACC_NO,BT_ACC_NAME,BT_AMOUNT,BTS_DATA,BT_DEBITED_ON,BT_BANK_CODE,BT_BRANCH_CODE,BT_BANK_ADDRESS,BT_SWIFT_CODE,BTCT_DATA,BT_CUST_REF,BT_INV_DETAILS,BTCB_DATA,BT_COMMENTS,BT_USERSTAMP,BT_TIMESTAMP) SELECT BT.BT_ID,BTT.BTT_DATA,BT.BT_DATE,U.UNIT_NO,C.CUSTOMER_FIRST_NAME,C.CUSTOMER_LAST_NAME,BT.BT_ACC_NO,BT.BT_ACC_NAME,BT.BT_AMOUNT,BTS.BTS_DATA,BT.BT_DEBITED_ON,BT.BT_BANK_CODE,BT.BT_BRANCH_CODE,BT.BT_BANK_ADDRESS,BT.BT_SWIFT_CODE,BTCT.BTCT_DATA,BT.BT_CUST_REF,BT.BT_INV_DETAILS,BTCB.BTCB_DATA,BT.BT_COMMENTS,BT.BT_USERSTAMP,BT.BT_TIMESTAMP FROM BANK_TRANSFER BT LEFT JOIN BANK_TRANSFER_DETAIL BTD ON BTD.BT_ID=BT.BT_ID,UNIT U,CUSTOMER C,BANK_TRANSFER_STATUS BTS,BANK_TRANSFER_CHARGES_TO BTCT,BANK_TRANSFER_CREATED_BY BTCB,BANK_TRANSFER_TYPE BTT WHERE BTT.BTT_ID=BT.BTT_ID AND U.UNIT_ID=BTD.UNIT_ID AND C.CUSTOMER_ID=BTD.CUSTOMER_ID AND BT.BTS_ID=BTS.BTS_ID AND BT.BTCT_ID=BTCT.BTCT_ID AND BTCB.BTCB_ID=BT.BTCB_ID AND BT.BT_DATE BETWEEN FROMVALUE AND TOVALUE;
INSERT INTO BANKTT_TEMP_TABLE(BT_ID,BTT_DATA,BT_DATE,BT_AMOUNT,BTS_DATA,BT_DEBITED_ON,BT_BANK_ADDRESS,BT_CUST_REF,BT_INV_DETAILS,BT_COMMENTS,BT_USERSTAMP,BTCB_DATA,BT_TIMESTAMP) SELECT BT.BT_ID,BTM.BTM_DATA,BT.BT_DATE,BT.BT_AMOUNT,BTS.BTS_DATA,BT_DEBITED_ON,BT.BT_BANK_ADDRESS,BT.BT_CUST_REF,BT.BT_INV_DETAILS,BT.BT_COMMENTS,BT.BT_USERSTAMP,BTCB.BTCB_DATA,BT.BT_TIMESTAMP FROM BANK_TRANSFER BT,BANK_TRANSFER_STATUS BTS,BANK_TRANSFER_CREATED_BY BTCB,BANK_TRANSFER_MODELS BTM WHERE BT.BTS_ID=BTS.BTS_ID AND BTCB.BTCB_ID=BT.BTCB_ID AND BTM.BTM_ID=BT.BTT_ID AND BT.BT_DATE BETWEEN FROMVALUE AND TOVALUE;
ELSE
INSERT INTO BANKTT_TEMP_TABLE(BT_ID,BTT_DATA,BT_DATE,UNIT_NO,CUSTOMER_FIRST_NAME,CUSTOMER_LAST_NAME,BT_ACC_NO,BT_ACC_NAME,BT_AMOUNT,BTS_DATA,BT_DEBITED_ON,BT_BANK_CODE,BT_BRANCH_CODE,BT_BANK_ADDRESS,BT_SWIFT_CODE,BTCT_DATA,BT_CUST_REF,BT_INV_DETAILS,BTCB_DATA,BT_COMMENTS,BT_USERSTAMP,BT_TIMESTAMP) SELECT BT.BT_ID,BTT.BTT_DATA,BT.BT_DATE,U.UNIT_NO,C.CUSTOMER_FIRST_NAME,C.CUSTOMER_LAST_NAME,BT.BT_ACC_NO,BT.BT_ACC_NAME,BT.BT_AMOUNT,BTS.BTS_DATA,BT.BT_DEBITED_ON,BT.BT_BANK_CODE,BT.BT_BRANCH_CODE,BT.BT_BANK_ADDRESS,BT.BT_SWIFT_CODE,BTCT.BTCT_DATA,BT.BT_CUST_REF,BT.BT_INV_DETAILS,BTCB.BTCB_DATA,BT.BT_COMMENTS,BT.BT_USERSTAMP,BT.BT_TIMESTAMP FROM BANK_TRANSFER BT LEFT JOIN BANK_TRANSFER_DETAIL BTD ON BTD.BT_ID=BT.BT_ID,UNIT U,CUSTOMER C,BANK_TRANSFER_STATUS BTS,BANK_TRANSFER_CHARGES_TO BTCT,BANK_TRANSFER_CREATED_BY BTCB,BANK_TRANSFER_TYPE BTT WHERE BTT.BTT_ID=BT.BTT_ID AND U.UNIT_ID=BTD.UNIT_ID AND C.CUSTOMER_ID=BTD.CUSTOMER_ID AND BT.BTS_ID=BTS.BTS_ID AND BT.BTCT_ID=BTCT.BTCT_ID AND BTCB.BTCB_ID=BT.BTCB_ID AND BT.BT_AMOUNT BETWEEN FROMVALUE AND TOVALUE;
INSERT INTO BANKTT_TEMP_TABLE(BT_ID,BTT_DATA,BT_DATE,BT_AMOUNT,BTS_DATA,BT_DEBITED_ON,BT_BANK_ADDRESS,BT_CUST_REF,BT_INV_DETAILS,BT_COMMENTS,BT_USERSTAMP,BTCB_DATA,BT_TIMESTAMP) SELECT BT.BT_ID,BTM.BTM_DATA,BT.BT_DATE,BT.BT_AMOUNT,BTS.BTS_DATA,BT_DEBITED_ON,BT.BT_BANK_ADDRESS,BT.BT_CUST_REF,BT.BT_INV_DETAILS,BT.BT_COMMENTS,BT.BT_USERSTAMP,BTCB.BTCB_DATA,BT.BT_TIMESTAMP FROM BANK_TRANSFER BT,BANK_TRANSFER_STATUS BTS,BANK_TRANSFER_CREATED_BY BTCB,BANK_TRANSFER_MODELS BTM WHERE BT.BTS_ID=BTS.BTS_ID AND BTCB.BTCB_ID=BT.BTCB_ID AND BTM.BTM_ID=BT.BTT_ID AND BT.BT_AMOUNT BETWEEN FROMVALUE AND TOVALUE;
END IF;
COMMIT;
END;